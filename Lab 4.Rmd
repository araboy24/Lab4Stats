---
title: "Lab 4: MATH 4753"
author: "Eid Zaben"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_float: yes
    theme: spacelab
    highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Task 1

```{r}
getwd()
```

# Task 2

```{r}
spruce.df = read.csv("SPRUCE.csv")
tail(spruce.df)
```

# Task 3

```{r}
library(s20x)
with (spruce.df, 
  trendscatter(Height~BHDiameter,f=0.5)
)

spruce.lm=with(spruce.df,lm(Height~BHDiameter)) 

height.res = residuals(spruce.lm)

height.fit=fitted(spruce.lm)

plot(height.fit,height.res)

trendscatter( height.fit,height.res)
```

The shape seen in the plot of comparing the fitted and residual values of height is a concave down parabolic graph that increases from 12 to 18 and decreases from 18 to 24. Compared to the first plot, the difference is due to residuals and fitted being plotted instead of the BHdiameter and Height. This indicates that a linear model is not a sufficient representation. 

```{r}
plot(spruce.lm, which =1)
normcheck(spruce.lm,shapiro.wilk = TRUE)
```

The p value of the Shapiro-Wilk test is 0.29. The null hypothesis in this case is accepted because the p value is larger than 0.05, so the error should be distributed normally. 

Since the plot of residuals vs fitted values in parabolic and not straight, a straight line model would not work properly. The noise needs to be found instead of the signal. The model also needs to be adjusted in order to accurately portray the data. 


# Task 4

## TODO quad.lm looks like its plotted wrong

```{r}
quad.lm=lm(Height~BHDiameter + I(BHDiameter^2),data=spruce.df)
summary(quad.lm)
```

```{r}
plot(spruce.df)

plt = function(x) { 
  quad.lm$coef[1] + quad.lm$coef[2] * x + quad.lm$coef[3]*x^2
  }

curve(plt, lwd = 2, col = "red", add = TRUE)
```

```{r}
quad.fit = fitted(quad.lm)

plot(quad.lm, which = 1)
```

```{r}
normcheck(quad.lm, shapiro.wilk = TRUE)
```

The p value is 0.684, so the null hypothesis is accepted because the p value is larger than 0.05. There is no noticeable trend in the plot between the residuals and the fitted values. Because of this, a quadratic model is better than a linear model. 

# Task 5

```{r}
summary(quad.lm)
```

Beta Hat 0 = 0.860896

Beta Hat 1 = 1.469592

Beta Hat 2 = -0.027457

```{r}
ciReg(quad.lm)
```

The fitted line equation is:

Height = 0.860896 + 1.469592x + -0.027457x^2

```{r}
predict(quad.lm, data.frame(BHDiameter =c(15, 18, 20)))
```

These predictions are larger than the previous one's that were found with spruce.lm. This is because quad.lm follows quadratic growth.

```{r}
summary(quad.lm)$r.squared
summary(spruce.lm)$r.squared
```
The R squared from the quaratic is larger. 

```{r}
summary(quad.lm)$adj.r.squared
summary(spruce.lm)$adj.r.squared
```

The adjusted R squared shows how well a model matches the data. A larger R squares means the model improved. This indicates that quad.lm is a better fit. 

Multiple R squared is an indication of how well a model describes the data independent of the number of data points. 

quad.lm explains the most variability in height because its R squared values are larger. 

```{r}
anova(spruce.lm)
anova(quad.lm)
```

Since quad.lm has a smaller RSS value, it is a better representation of the data. 

```{r}
height.qfit = fitted(quad.lm)
TSS = sum((spruce.df$Height - mean(spruce.df$Height))^2)
TSS

MSS = sum((height.qfit - mean(spruce.df$Height))^2)
MSS

RSS = sum((spruce.df$Height - height.qfit)^2)
RSS

MSS/TSS
```

